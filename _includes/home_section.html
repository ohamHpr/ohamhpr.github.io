{% capture xyz %}
    {% if include.maxVisibleItems == nil %}
        {% assign maxVisibleItems = 3 %}
    {% else %}    
        {% assign maxVisibleItems = include.maxVisibleItems %}
    {% endif %}
{% endcapture %}

{% capture titleClass -%}
    {%- if include.titleAlign == 'top' -%}
        align-self-top
    {%- else -%}
        align-self-center
    {%- endif %}
{%- endcapture %}

<section id="{{ include.id }}" class="{{ include.stripColor }}">
    <div class="mt-4 row {% if include.deleyed-attention == false %}{% else %}deleyed-attention content-blur{% endif %}">
        {% if include.title %}
        <div class="col-3 {{titleClass}} text-muted">
            <h3>{{ include.title }}</h3>
        </div>
        {% endif %}

        <div class="{% if include.title %}col-7{% else %}col{% endif %} offset-0">
            {% assign typeSelectArray = include.type | replace: ' ', '' | split: ',' %}
            
            {% for typeString in typeSelectArray %}
            {% for collection in site.collections %}
                {% if typeString == collection.label %}

                    {% assign collection = site.collections | where: "label", include.type | first %}
                    {% assign alldocs = collection.docs | map: "path" | join: ', ' %}
                    {% assign fullSelect = alldocs | replace: '.html', '' | replace: collection.relative_directory, '' | replace: '/', '' %}

                    {% capture selectString -%}
                        {%- if include.select == nil -%}
                            {{fullSelect}}
                        {%- else -%}
                            {{include.select}}
                        {%- endif -%}
                    {%- endcapture -%}
                    
                    {% assign select = selectString | replace: ' ', '' | split: ',' %}
                    {% assign itemSize = select.size %}

                    {% for basename in select %}
                        {% assign index = forloop.index %}
                        {%- capture docItemId -%}
                            docItemId_{{collection.label}}_{{ index }}
                        {%- endcapture %}

                        {% for doc in collection.docs %}
                            {% assign docBasename = doc.path | split:'/' | last | split: '.' | first %}          

                            {% if docBasename == basename %}

                                {% capture cardBorder -%}
                                    {%- if include.cardBorder -%}
                                        {{include.cardBorder}}
                                    {%- else -%}
                                        {{doc.cardBorder}}
                                    {%- endif -%}
                                {%- endcapture -%}
                                
                                {% include minimal_view.html 
                                    id = docItemId
                                    url = doc.permalink
                                    title = doc.title
                                    subtitle = doc.subtitle
                                    muted = doc.muted
                                    excerpt = doc.excerpt
                                    content = doc.content
                                    equalHeight = include.equalHeight
                                    cardBorder = cardBorder
                                    badge = doc.badge
                                    index = index
                                    maxVisibleItems = maxVisibleItems
                                %}
                            {% endif %}
                        {% endfor %}
                    {% endfor %}

                {% endif %}
            {% endfor %}
            {% endfor %}
        </div>
    
        <div class="row text-end">
            <a  id="displayMore_{{ collection.label }}"
                class="display-more-items link-success {% if itemSize <= maxVisibleItems %}d-none{% endif %}" 
                href="#" data-target-item="{{ include.id }}"
                onclick="return displayMoreItems()">
                Display more
            </a>
        </div>
    </div>
</section>